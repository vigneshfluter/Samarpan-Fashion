<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samarpan Fashion</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="loginSection" class="login-overlay">
        <div class="login-card">
            <div class="login-header">
                <div class="icon-bg"><i class="fa-solid fa-shirt"></i></div>
                <h1>Samarpan Fashion</h1>
                <p id="loginDateDisplay"></p> </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email ID</label>
                    <input type="email" id="loginEmail" placeholder="Enter Email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPass" placeholder="Enter Password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block btn-lg">Secure Login</button>
                <p id="loginError" class="login-error">Invalid Email or Password!</p>
            </form>
        </div>
    </div>

    <nav class="sidebar">
        <div class="brand">
            <i class="fa-solid fa-shirt"></i>
            <div><h2>Samarpan</h2><small>Fashion</small></div>
        </div>
        <ul>
            <li onclick="showSection('billing')" class="active"><i class="fa-solid fa-cash-register"></i> <span>Billing</span></li>
            <li onclick="showSection('inventory')"><i class="fa-solid fa-boxes-stacked"></i> <span>Inventory</span></li>
            <li onclick="showSection('reports')"><i class="fa-solid fa-chart-line"></i> <span>Reports</span></li>
        </ul>
        <div class="backup-section">
            <h4>Data Safety</h4>
            <ul>
                <li onclick="backupData()"><i class="fa-solid fa-download"></i> Backup</li>
                <li onclick="document.getElementById('restoreFile').click()"><i class="fa-solid fa-upload"></i> Restore</li>
            </ul>
            <input type="file" id="restoreFile" style="display:none" onchange="restoreData(this)">
        </div>
    </nav>

    <main class="content">
        
        <section id="billing" class="section active-section">
            <div class="billing-wrapper">
                <div class="billing-main">
                    <div class="scan-header">
                        <div class="search-box">
                            <i class="fa-solid fa-barcode"></i>
                            <input type="text" id="barcodeInput" placeholder="Scan Barcode or Type Code..." autofocus autocomplete="off">
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-warning" onclick="holdBill()" title="Park current bill">
                                <i class="fa-solid fa-pause"></i> Hold
                            </button>
                            <button class="btn btn-dark" onclick="openHeldModal()" title="View parked bills">
                                <i class="fa-solid fa-list"></i> Held <span id="heldCount" class="badge">0</span>
                            </button>
                            <button class="btn btn-outline-danger" onclick="clearCart()">
                                <i class="fa-solid fa-trash-can"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div class="cart-area">
                        <table class="cart-table">
                            <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th width="60">Size</th>
                                    <th width="100">Price</th>
                                    <th width="120">Qty</th>
                                    <th width="100">Total</th>
                                    <th width="50"></th>
                                </tr>
                            </thead>
                            <tbody id="cartTableBody"></tbody>
                        </table>
                        <div id="emptyCartMsg" class="empty-state">
                            <i class="fa-solid fa-basket-shopping"></i>
                            <h3>Ready to Bill</h3>
                            <p>Scan a product to add it to the cart.</p>
                        </div>
                    </div>
                </div>

                <div class="billing-sidebar">
                    <div class="stats-widget">
                        <div class="stat-item">
                            <small>Today's Sale</small>
                            <span id="dailyTotalDisplay">₹0.00</span>
                        </div>
                        <div class="stat-separator"></div>
                        <div class="stat-item">
                            <small>Items Sold</small>
                            <span id="dailyItemsDisplay">0</span>
                        </div>
                    </div>

                    <div class="checkout-details">
                        <div class="customer-info-group">
                            <label>Customer Details</label>
                            <input type="text" id="custName" placeholder="Customer Name">
                            <input type="number" id="custMobile" placeholder="Mobile Number">
                        </div>
                        <div class="total-display">
                            <small>Grand Total</small>
                            <div id="grandTotal">₹0.00</div>
                        </div>
                        <div class="payment-input-group">
                            <label>Cash Received (₹)</label>
                            <input type="number" id="amountPaid" placeholder="Enter Amount..." onkeyup="calculateChange()">
                        </div>
                        <div class="return-display">
                            <span>Change Return:</span>
                            <span id="changeToReturn">--</span>
                        </div>
                    </div>

                    <div class="checkout-actions">
                        <button class="btn btn-primary btn-block btn-lg" onclick="processSale('print')">
                            <i class="fa-solid fa-print"></i> PRINT BILL
                        </button>
                        <div class="date-display" id="currentDate"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="inventory" class="section">
            <header>
                <h1>Inventory Management</h1>
                <div class="header-tools">
                    <button class="btn btn-info" onclick="downloadSample()">Download Template</button>
                    <button class="btn btn-dark" onclick="document.getElementById('importFile').click()"><i class="fa-solid fa-file-import"></i> Import CSV</button>
                    <input type="file" id="importFile" hidden onchange="importCSV(this)">
                </div>
            </header>
            <div class="inventory-layout">
                <div class="card form-card">
                    <h3 id="formTitle">Add New Item</h3>
                    <form id="addProductForm">
                        <input type="hidden" id="editId">
                        <div class="form-group"><label>Product Name</label><input type="text" id="prodName" required placeholder="Enter Item Name"></div>
                        <div class="grid-2">
                            <div class="form-group"><label>Size</label><input type="text" id="prodSize" placeholder="e.g. M, XL, 40"></div>
                            <div class="form-group"><label>Price (₹)</label><input type="number" id="prodPrice" required placeholder="0.00"></div>
                        </div>
                        <div class="form-group">
                            <label>Barcode</label>
                            <div class="input-group">
                                <input type="text" id="prodBarcode" placeholder="Scan or Auto-generate">
                                <button type="button" class="btn btn-secondary" onclick="generateRandomBarcode()">Auto</button>
                            </div>
                        </div>
                        <button type="submit" id="saveBtn" class="btn btn-success full-width">Save Product</button>
                        <button type="button" id="cancelEditBtn" class="btn btn-secondary full-width" style="display:none; margin-top:10px;" onclick="resetForm()">Cancel Edit</button>
                    </form>
                </div>
                <div class="card table-card">
                    <div class="table-header">
                        <h3>Stock List</h3>
                        <div class="inventory-search">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="inventorySearch" placeholder="Search..." onkeyup="renderInventory()">
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="styled-table">
                            <thead><tr><th>Barcode</th><th>Product</th><th>Size</th><th>Price</th><th>Stock</th><th>Action</th></tr></thead>
                            <tbody id="inventoryTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="reports" class="section">
            <header>
                <h1>Sales History</h1>
                <button class="btn btn-success" onclick="exportReport()"><i class="fa-solid fa-file-excel"></i> Export to Excel</button>
            </header>
            <div class="card">
                <div class="table-responsive">
                    <table class="styled-table">
                        <thead><tr><th>Bill ID</th><th>Date</th><th>Customer</th><th>Items</th><th>Total</th><th>Action</th></tr></thead>
                        <tbody id="salesHistoryBody"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <div id="heldBillsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><h2>Held / Parked Bills</h2><button class="close-btn" onclick="closeHeldModal()">&times;</button></div>
            <div class="modal-body">
                <table class="styled-table"><thead><tr><th>Time</th><th>Customer</th><th>Amount</th><th>Action</th></tr></thead><tbody id="heldBillsBody"></tbody></table>
                <div id="noHeldMsg" style="text-align:center; padding:20px; color:#64748b; display:none;">No held bills found.</div>
            </div>
        </div>
    </div>

    <div id="receipt-template" class="receipt-hidden">
        <div class="r-container">
            <div class="r-header"><h2>SAMARPAN FASHION</h2><p>Main Bazaar, Jasdan</p><p>Mo: +91 98765 43210</p></div>
            <div class="dashed-line"></div>
            <div class="r-meta"><span>Date: <b id="r-date"></b></span><span>Bill No: <b id="r-id"></b></span></div>
            <div class="r-customer"><p id="r-cust-name"></p><p id="r-cust-mobile"></p></div>
            <div class="dashed-line"></div>
            <table class="r-table"><thead><tr><th class="text-left">ITEM</th><th class="text-center">SIZE</th><th class="text-center">QTY</th><th class="text-right">PRICE</th><th class="text-right">AMT</th></tr></thead><tbody id="r-body"></tbody></table>
            <div class="dashed-line"></div>
            <div class="r-total"><span>GRAND TOTAL</span><span id="r-total"></span></div>
            <div class="dashed-line"></div>
            <div class="r-footer"><p>THANK YOU VISIT AGAIN</p><p>No Exchange/Return without Bill</p><div class="barcode-container"><svg id="r-barcode"></svg></div></div>
        </div>
    </div>

    <div id="label-overlay" class="label-hidden"><div id="label-sheet" class="a4-page"></div></div>
    <script src="script.js"></script>
</body>
</html>